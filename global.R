# Global things sourced in each blogpost

# First up: dependency checking ----
if (!("devtools" %in% installed.packages())) install.packages("devtools")
devtools::install_deps(".", upgrade = "never")

# Global stuff ----
library(ggplot2)
library(dplyr)
library(knitr)
library(tadaatoolbox)

source(here::here("helpers.R"))

# Hugo config
# config_toml <- RcppTOML::parseTOML(here::here("config.toml"))

# knitr: Global chunk options
knitr::opts_chunk$set(
  out.width = "90%",
  fig.retina = 2,
  error = FALSE,
  warning = FALSE,
  message = FALSE,
  comment = "",
  cache = TRUE
)

# Code highlighting via prims.js requires manually set class
knitr::opts_chunk$set(
  class.source = c("language-r")
)

# Set hook defined in helpers.R
knitr::knit_hooks$set(
  plot = hook
)

# Enable the code-hiding-via-summary-tags thing
# Shamelessly stolen from
# https://github.com/cpsievert/plotly_book/blob/a95fb991fdbfdab209f5f86ce1e1c181e78f801e/index.Rmd#L52-L60
knit_hooks$set(summary = function(before, options, envir) {
  if (length(options$summary)) {
    if (before) {
      return(sprintf("<details><summary>%s</summary>\n", options$summary))
    } else {
      return("\n</details>")
    }
  }
})

# Plot output ----

# ggplot2 theme
ggplot2::theme_set(
  firasans::theme_ipsum_fsc() +
    theme(
      panel.spacing.y = unit(2.5, "mm"),
      panel.spacing.x = unit(2, "mm"),
      plot.margin = margin(t = 7, r = 5, b = 7, l = 5),
      legend.position = "bottom",
      plot.background = element_rect(fill = "#FCFCFC", color = "#FCFCFC"),
      panel.background = element_rect(fill = "#FCFCFC", color = "#FCFCFC")
    )
)
